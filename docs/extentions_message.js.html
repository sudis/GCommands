<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Source: extentions/message.js</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <script src="scripts/nav.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.3/fuse.min.js"></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link type="text/css" rel="stylesheet" href="styles/skyceil.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
</head>

<body>

<nav class="navbar">
    <div class="utilities">
        <div id="search">
            <input type="text" id="search-box" placeholder="Search"><br>
            <div id="search-results" style="display: none;"></div>
        </div>
        <button class="theme" data-theme="light"><i class="fas fa-moon"></i></button>
    </div>
    <hr>
    <h4><a href="index.html">Home</a></h4><h5 class="no-bottom must-underline">Classes</h5><ul><li><span class="small-icon C">C</span><a href="Buttons.html">Buttons</a></li><li><span class="small-icon C">C</span><b><a href="Color.html">Color</a></b><ul class="has-class-methods"><li><span class="small-icon F">F</span><a href="Color.html#getRGB">getRGB</a></li><li><span class="small-icon F">F</span><a href="Color.html#getText">getText</a></li><li><span class="small-icon M">M</span><a href="Color.html#text">text</a></li></ul></li><li><span class="small-icon C">C</span><b><a href="GCommands.html">GCommands</a></b><ul class="has-class-methods"><li><span class="small-icon M">M</span><a href="GCommands.html#cmdDir">cmdDir</a></li><li><span class="small-icon M">M</span><a href="GCommands.html#cooldownDefault">cooldownDefault</a></li><li><span class="small-icon M">M</span><a href="GCommands.html#database">database</a></li><li><span class="small-icon M">M</span><a href="GCommands.html#eventDir">eventDir</a></li><li><span class="small-icon M">M</span><a href="GCommands.html#prefix">prefix</a></li><li><span class="small-icon M">M</span><a href="GCommands.html#slash">slash</a></li><li><span class="small-icon M">M</span><a href="GCommands.html#unkownCommandMessage">unkownCommandMessage</a></li></ul></li><li><span class="small-icon C">C</span><a href="GCommandsBase.html">GCommandsBase</a></li><li><span class="small-icon C">C</span><b><a href="GCommandsDispatcher.html">GCommandsDispatcher</a></b><ul class="has-class-methods"><li><span class="small-icon F">F</span><a href="GCommandsDispatcher.html#addInhibitor">addInhibitor</a></li><li><span class="small-icon F">F</span><a href="GCommandsDispatcher.html#getGuildPrefix">getGuildPrefix</a></li><li><span class="small-icon F">F</span><a href="GCommandsDispatcher.html#removeInhibitor">removeInhibitor</a></li><li><span class="small-icon F">F</span><a href="GCommandsDispatcher.html#setGuildPrefix">setGuildPrefix</a></li><li><span class="small-icon M">M</span><a href="GCommandsDispatcher.html#client">client</a></li></ul></li><li><span class="small-icon C">C</span><b><a href="GCommandsEventLoader.html">GCommandsEventLoader</a></b><ul class="has-class-methods"><li><span class="small-icon F">F</span><a href="GCommandsEventLoader.html#createAPIMessage">createAPIMessage</a></li><li><span class="small-icon F">F</span><a href="GCommandsEventLoader.html#getSlashArgs">getSlashArgs</a></li><li><span class="small-icon F">F</span><a href="GCommandsEventLoader.html#inhibit">inhibit</a></li><li><span class="small-icon M">M</span><a href="GCommandsEventLoader.html#GCommandsClient">GCommandsClient</a></li></ul></li><li><span class="small-icon C">C</span><b><a href="GCommandsGuild.html">GCommandsGuild</a></b><ul class="has-class-methods"><li><span class="small-icon F">F</span><a href="GCommandsGuild.html#getCommandPrefix">getCommandPrefix</a></li><li><span class="small-icon F">F</span><a href="GCommandsGuild.html#setCommandPrefix">setCommandPrefix</a></li></ul></li><li><span class="small-icon C">C</span><b><a href="GCommandsMessage.html">GCommandsMessage</a></b><ul class="has-class-methods"><li><span class="small-icon F">F</span><a href="GCommandsMessage.html#buttons">buttons</a></li><li><span class="small-icon F">F</span><a href="GCommandsMessage.html#buttonsWithReply">buttonsWithReply</a></li><li><span class="small-icon F">F</span><a href="GCommandsMessage.html#inlineReply">inlineReply</a></li></ul></li><li><span class="small-icon C">C</span><b><a href="GEvents.html">GEvents</a></b><ul class="has-class-methods"><li><span class="small-icon M">M</span><a href="GEvents.html#eventDir">eventDir</a></li></ul></li></ul><h5 class="no-bottom must-underline">Events</h5><ul><li><span class="small-icon E">E</span><a href="GCommands.html#event:debug">debug</a></li></ul><h4>Global</h4><ul><li><a href="global.html#ReturnSystem">ReturnSystem</a></li></ul>
</nav>

<div id="main">
    <div class="burger">
        <div class="burger-line-1"></div>
        <div class="burger-line-2"></div>
        <div class="burger-line-3"></div>
    </div>

    <h1 class="page-title">Source: extentions/message.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const { APIMessage, Structures, Message } = require('discord.js');

module.exports = Structures.extend("Message", message => {
    /**
     * The MessageStructure structure
     * @class
    */
    class GCommandsMessage extends Message {
        constructor(...args) {
            super(...args)
        }

        /**
         * Method to make buttons
         * @param {String} content
         * @param {Object} options
         * @returns {Promise}
        */
        async buttons(content, options) {
            if (!options.buttons) {
                options.buttons = [];
            }

            if(!options.allowedMentions) {
                options.allowedMentions = { parse: ["users", "roles", "everyone"] };
            }

            if (!Array.isArray(options.buttons)) {
                return console.log(new Color("&amp;d[GCommands] &amp;cThe buttons must be array.",{json:false}).getText());
            }

            var buttons = [];
            var styles = ['blupurple', 'grey', 'green', 'red', 'url'];

            options.buttons.forEach((x, i) => {
                if (!x.style) x.style = 'blupurple';

                if (!styles.includes(x.style)) {
                    return console.log(new Color(`&amp;d[GCommands] &amp;c#${i} button has invalid style, recived ${x.style}`,{json:false}).getText());
                }

                if (!x.label) {
                    return console.log(new Color(`&amp;d[GCommands] &amp;c#${i} don't has label!`,{json:false}).getText());
                }

                if (typeof (x.label) !== 'string') x.label = String(x.label);

                if (x.style === 'url') {
                    if (!x.url) {
                        return console.log(new Color(`&amp;d[GCommands] &amp;cIf the button style is "url", you must provide url`,{json:false}).getText());
                    }
                } else {
                    if (!x.id) {
                        return console.log(new Color(`&amp;d[GCommands] &amp;cIf the button style is not "url", you must provide custom id`,{json:false}).getText());
                    }
                }

                var style;

                if (x.style === 'blupurple') {
                    style = 1;
                } else if (x.style === 'grey') {
                    style = 2;
                } else if (x.style === 'green') {
                    style = 3;
                } else if (x.style === 'red') {
                    style = 4;
                } else if (x.style === 'url') {
                    style = 5;
                }

                var data = {
                    type: 2,
                    style: style,
                    label: x.label,
                    custom_id: x.id || null,
                    url: x.url || null
                }

                buttons.push(data);
            })

            options.buttons === null;

            this.client.ws.on('INTERACTION_CREATE', async (data) => {
                let typeStyles = {
                    1: 'blupurple',
                    2: 'grey',
                    3: 'green',
                    4: 'red',
                    5: 'url'
                };

                await this.client.channels.cache.get(data.channel_id).messages.fetch();

                var message;
                try {
                    message = await this.client.channels.cache.get(data.channel_id).messages.cache.get(data.message.id);
                } catch(e) {
                    message = await this.client.channels.cache.get(data.channel_id)
                }

                var clicker = await this.client.guilds.cache.get(data.guild_id).members.cache.get(data.member.user.id);

                this.client.emit('clickButton', {
                    version: data.version,
                    type: data.type,
                    style: typeStyles[data.type],
                    token: data.token,
                    id: data.data.custom_id,
                    discordId: data.id,
                    applicationId: data.application_id,
                    clicker: clicker,
                    message
                })
            });

            this.client.api.channels[this.channel.id].messages.post({
                headers: {
                "Content-Type": 'applications/json'
                },
                data: {
                    allowed_mentions: options.allowedMentions,
                    content: content,
                    components: [
                        {
                            type: 1,
                            components: buttons
                        }
                    ],
                    options,
                    embed: options.embed || null
                }
            });
        }

        /**
         * Method to inlineReply
         * @param {String} content
         * @param {Object} options
         * @returns {Promise}
        */
        async inlineReply(content, options) {
            const mentionRepliedUser = typeof ((options || content || {}).allowedMentions || {}).repliedUser === "undefined" ? true : ((options || content).allowedMentions).repliedUser;
            delete ((options || content || {}).allowedMentions || {}).repliedUser;

            const apiMessage = content instanceof APIMessage ? content.resolveData() : APIMessage.create(this.channel, content, options).resolveData();
            Object.assign(apiMessage.data, { message_reference: { message_id: this.id } });

            if (!apiMessage.data.allowed_mentions || Object.keys(apiMessage.data.allowed_mentions).length === 0)
            apiMessage.data.allowed_mentions = { parse: ["users", "roles", "everyone"] };
            if (typeof apiMessage.data.allowed_mentions.replied_user === "undefined")
            Object.assign(apiMessage.data.allowed_mentions, { replied_user: mentionRepliedUser });

            if (Array.isArray(apiMessage.data.content)) {
                return Promise.all(apiMessage.split().map(x => {
                    x.data.allowed_mentions = apiMessage.data.allowed_mentions;
                    return x;
                }).map(this.inlineReply.bind(this)));
            }

            const { data, files } = await apiMessage.resolveFiles();
            return this.client.api.channels[this.channel.id].messages
                .post({ data, files })
                .then(d => this.client.actions.MessageCreate.handle(d).message);
        }

        /**
         * Method to buttonsWithReply
         * @param {String} content
         * @param {Object} options
         * @returns {Promise}
        */
        async buttonsWithReply(content, options) {
            if (!options.buttons) {
                options.buttons = [];
            }

            if(!options.allowedMentions) {
                options.allowedMentions = { parse: ["users", "roles", "everyone"] };
            }

            if (!Array.isArray(options.buttons)) {
                return console.log(new Color("&amp;d[GCommands] &amp;cThe buttons must be array.",{json:false}).getText());
            }

            var buttons = [];
            var styles = ['blupurple', 'grey', 'green', 'red', 'url'];

            options.buttons.forEach((x, i) => {
                if (!x.style) x.style = 'blupurple';

                if (!styles.includes(x.style)) {
                    return console.log(new Color(`&amp;d[GCommands] &amp;c#${i} button has invalid style, recived ${x.style}`,{json:false}).getText());
                }

                if (!x.label) {
                    return console.log(new Color(`&amp;d[GCommands] &amp;c#${i} don't has label!`,{json:false}).getText());
                }

                if (typeof (x.label) !== 'string') x.label = String(x.label);

                if (x.style === 'url') {
                    if (!x.url) {
                        return console.log(new Color(`&amp;d[GCommands] &amp;cIf the button style is "url", you must provide url`,{json:false}).getText());
                    }
                } else {
                    if (!x.id) {
                        return console.log(new Color(`&amp;d[GCommands] &amp;cIf the button style is not "url", you must provide custom id`,{json:false}).getText());
                    }
                }

                var style;

                if (x.style === 'blupurple') {
                    style = 1;
                } else if (x.style === 'grey') {
                    style = 2;
                } else if (x.style === 'green') {
                    style = 3;
                } else if (x.style === 'red') {
                    style = 4;
                } else if (x.style === 'url') {
                    style = 5;
                }

                var data = {
                    type: 2,
                    style: style,
                    label: x.label,
                    custom_id: x.id || null,
                    url: x.url || null
                }

                buttons.push(data);
            })

            options.buttons === null;

            this.client.ws.on('INTERACTION_CREATE', async (data) => {
                let typeStyles = {
                    1: 'blupurple',
                    2: 'grey',
                    3: 'green',
                    4: 'red',
                    5: 'url'
                };

                await this.client.channels.cache.get(data.channel_id).messages.fetch();

                var message;
                try {
                    message = await this.client.channels.cache.get(data.channel_id).messages.cache.get(data.message.id);
                } catch(e) {
                    message = await this.client.channels.cache.get(data.channel_id)
                }

                var clicker = await this.client.guilds.cache.get(data.guild_id).members.cache.get(data.member.user.id);

                this.client.emit('clickButton', {
                    version: data.version,
                    type: data.type,
                    style: typeStyles[data.type],
                    token: data.token,
                    id: data.data.custom_id,
                    discordId: data.id,
                    applicationId: data.application_id,
                    clicker: clicker,
                    message
                })
            });

            this.client.api.channels[this.channel.id].messages.post({
                headers: {
                "Content-Type": 'applications/json'
                },
                data: {
                    allowed_mentions: options.allowedMentions,
                    content: content,
                    components: [
                        {
                            type: 1,
                            components: buttons
                        }
                    ],
                    message_reference: {
                        message_id: this.channel.lastMessageID
                    },
                    options,
                    embed: options.embed || null
                }
            });
        }
    }

    return GCommandsMessage;
})</code></pre>
        </article>
    </section>





</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Wed May 26 2021 14:16:14 GMT+0200 (stredoeurópsky letný čas) using <a href="https://github.com/devsnowflake/jsdoc-skyceil">Skyceil Theme</a>
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>

</body>
</html>
